matrix:
  include:
    - language: python
      sudo: true
      dist: trusty
      python: 3.5
      before_install:
        - sudo apt-get install -y python3.5 python3.5-dev
        - sudo rm -f /usr/bin/python
        - sudo rm -f /usr/bin/python3
        - sudo ln -s /usr/bin/python3.5 /usr/bin/python
        - sudo ln -s /usr/bin/python3.5 /usr/bin/python3


      install:
        - curl -s https://install.zerotier.com/ | sudo bash
        - sudo ./tests/integration_tests/travis/jumspcale_install.sh ${js_branch}
        - sudo apt-get install python3-pip
        - sudo pip3 install -r tests/integration_tests/requirements.txt
        - sudo python3 ./tests/integration_tests/travis/setup.py --action create --zos-version ${core_0_branch} --zt-token ${zerotier_token} --pckt_token ${packet_token}

      script:
        - sudo bash tests/integration_tests/travis/travis_script.sh
      after_script:
        - sudo python3 ./tests/integration_tests/travis/setup.py --action delete --zos-version ${core_0_branch} --zt-token ${zerotier_token} --pckt_token ${packet_token}


    - language: python
      sudo: enabled
      dist: trusty
      group: edge

      # whitelist master/development branch only
      branches:
        only:
          - master
          - development

      python:
        - "3.5"

      before_install:
        - sudo apt-get install -y python3.5 python3.5-dev
        - sudo rm -f /usr/bin/python
        - sudo rm -f /usr/bin/python3
        - sudo ln -s /usr/bin/python3.5 /usr/bin/python
        - sudo ln -s /usr/bin/python3.5 /usr/bin/python3

      install: sudo ./.travis_ci/prepare.sh

      before_script:
        - sudo pip3 install pytest 

      script: sudo ./run_tests.sh
